# 变更提案: VSCode 窗口列表与一键切换

## 需求背景

在 macOS 上同时打开多个 VSCode 窗口/实例时，用户往往需要在 Dock、⌘`、Mission Control 中反复定位目标窗口，成本高且不直观。  
目标是提供一个明确的“窗口列表 + 一键切换”入口：列出当前系统中所有已打开的 VSCode 窗口，并在每行右侧提供切换按钮，点击后把对应窗口激活到前台。

## 产品分析

### 目标用户与场景
- **用户群体:** macOS 上重度使用 VSCode 的开发者
- **使用场景:** 多项目并行、多窗口分屏、同时运行 Stable/Insiders
- **核心痛点:** “我知道窗口存在，但找它/切它很慢”

### 价值主张与成功指标
- **价值主张:** 以窗口为单位的显式导航，让“找窗口”变成一次点击
- **成功指标:**
  - 2 次点击内完成从任意应用切到目标 VSCode 窗口
  - 在 3+ 个 VSCode 窗口场景下仍能稳定列出与切换

### 人文关怀
仅使用必要的系统权限（辅助功能），不采集/外传任何窗口内容；在 UI 中明确告知权限用途并提供关闭/重试入口。

## 变更内容
1. 枚举系统中已运行的 VSCode/VSCode Insiders 窗口列表（标题 + 应用名）
2. 每个窗口提供 “Switch” 按钮，点击后将目标窗口激活并置前
3. 权限缺失时展示引导页，支持一键打开系统设置并重试

## 影响范围
- **模块:** VSCode-Switcher（单模块）
- **文件:**
  - `VSCode-Switcher/ContentView.swift`
  - `VSCode-Switcher/VSCode_SwitcherApp.swift`
- **API:** 无外部 API
- **数据:** UserDefaults（用于可选的槽位绑定；本 FEATURE 本身不依赖持久化）

## 核心场景

### 需求: 显示 VSCode 窗口列表
**模块:** VSCode-Switcher
在应用主窗口中展示“当前系统中已打开的 VSCode 窗口列表”。

#### 场景: 已授予辅助功能权限且存在窗口
条件：已在系统设置授予本应用“辅助功能”权限，且 VSCode 至少存在 1 个窗口。  
- 预期结果：列表展示全部窗口（至少包含 title），并可区分 Stable/Insiders（显示 app 名或 bundle id）。

#### 场景: 已授予权限但无窗口
条件：已授予权限，但 VSCode 未运行或无可枚举窗口。  
- 预期结果：展示空状态提示（引导打开 VSCode 并刷新）。

#### 场景: 未授予辅助功能权限
条件：未授予权限。  
- 预期结果：展示权限引导页，并提供打开系统设置与重试按钮；不崩溃、不输出误导性列表。

### 需求: 一键切换窗口到前台
**模块:** VSCode-Switcher
点击列表项右侧的 “Switch” 按钮后，将目标 VSCode 窗口切到前台（包含解除最小化）。

#### 场景: 目标窗口仍存在
条件：目标窗口仍存在且可访问。  
- 预期结果：VSCode 被激活，目标窗口成为主窗口并置前。

#### 场景: 目标窗口已关闭/不可访问
条件：点击时目标窗口已被关闭或 AX 无法访问。  
- 预期结果：安全失败（直接返回或降级聚焦第一个窗口），UI 仍可继续刷新重试。

## 风险评估
- **风险:** 依赖 Accessibility API，必须获得“辅助功能”权限；跨 Space 行为受系统设置影响。
- **缓解:** 明确告知权限用途、提供一键跳转设置与刷新；实现匹配降级与安全失败路径，避免崩溃。

