# 变更提案: 窗口列表交互增强（拖拽排序 / 点击激活 / 别名 / 新窗口追加）

## 需求背景

当前窗口列表已具备“点击整行激活 VSCode 窗口”与“拖拽排序”的雏形，但仍存在几个直接影响可用性的缺口：

- 列表项的可点击区域并未覆盖“拖拽手柄右侧的整行空白区域”，导致用户需要精确点到文本才能激活窗口（交互不符合直觉）。
- 缺少“别名”能力，窗口标题随文件/工程变化而变化时，用户难以稳定识别目标窗口。
- 新窗口出现时，列表顺序可能发生插入/重排，进一步导致“热键=列表前 10 项”的心智模型不稳定（误切换风险）。

目标是用**最小变更**把列表交互补齐，让“看得清、点得准、顺序稳定、热键稳定”。

## 产品分析

### 目标用户与场景
- **用户群体:** macOS 上多窗口/多实例使用 VSCode 的开发者
- **使用场景:** 同时开 3+ 个窗口；频繁用热键/鼠标切换；窗口标题经常变化
- **核心痛点:** “顺序会动 + 不好点 + 不好认”导致切换成本上升、误切换

### 价值主张与成功指标
- **价值主张:** 列表顺序成为用户可控的“主索引”，热键与其绑定，长期稳定
- **成功指标:**
  - 单击（除拖拽手柄）即可激活目标窗口，命中率接近 100%
  - 新窗口出现后不打乱已有顺序，且默认出现在列表底部
  - 用户可为窗口设置别名并在列表中稳定展示

### 人文关怀
不新增权限、不采集/外传任何信息；仅在本机 UserDefaults 保存必要的顺序与别名数据，并在行为上“可预测、可撤销（清空别名）”。

## 变更内容
1. **拖拽排序**：完善/验证列表拖拽排序行为，并确保顺序持久化后用于热键映射。
2. **点击激活区域**：除拖拽手柄区域外，行内其余区域（包含右侧空白）单击即可激活窗口。
3. **窗口别名**：列表中支持编辑别名；展示时优先显示别名，辅助显示原始标题。
4. **新窗口追加**：新监听到的窗口默认追加到列表底部，不插入、不重排已有项（避免热键漂移）。

## 影响范围
- **模块:** VSCode-Switcher（单模块）
- **文件（预计）:**
  - `VSCode-Switcher/ContentView.swift`
  - `VSCode-Switcher/VSCode_SwitcherApp.swift`
  - `helloagents/wiki/data.md`
  - `helloagents/wiki/modules/vscode-switcher.md`
  - `helloagents/CHANGELOG.md`
- **API:** 无外部 API 变更
- **数据:** 新增 UserDefaults 键用于“窗口别名”；调整“窗口顺序”持久化策略（确保新窗口追加语义）

## 核心场景

### 需求: 列表拖拽排序
**模块:** VSCode-Switcher

#### 场景: 通过拖拽手柄调整顺序
条件：列表存在 2+ 个窗口。  
- 预期结果：拖拽手柄可排序；松手后顺序立即稳定，且刷新/重启应用后保持一致。
- 预期结果：热键 `⌃⌥1~0` 对应列表前 10 项的新顺序（不漂移）。

### 需求: 点击激活区域覆盖整行（排除手柄）
**模块:** VSCode-Switcher

#### 场景: 点击拖拽手柄右侧任意位置
条件：存在窗口列表。  
- 预期结果：点击文本、点击右侧空白区域均可激活对应 VSCode 窗口。
- 预期结果：点击/拖拽手柄本身不触发激活（避免误触）。

### 需求: 编辑窗口别名
**模块:** VSCode-Switcher

#### 场景: 为某个窗口设置/清空别名
条件：存在窗口列表。  
- 预期结果：可进入别名编辑并保存；保存后列表优先显示别名，原始 title 作为辅助信息。
- 预期结果：清空别名后回退显示原始 title。
- 预期结果：编辑别名不应误触发“激活窗口”（需要显式交互入口）。

### 需求: 新窗口默认追加到底部
**模块:** VSCode-Switcher

#### 场景: 新打开一个 VSCode 窗口
条件：已有用户自定义顺序或系统已建立稳定顺序。  
- 预期结果：新窗口出现在列表底部；列表中已有项相对顺序不变；列表前 10 项对应热键不因插入而改变。

## 风险评估
- **风险:** 窗口标识 `VSCodeWindowItem.id` 依赖 `windowNumber`（缺失时退回 title），在极端情况下可能导致别名/顺序匹配偏移。
- **缓解:** 别名与顺序均以现有 `id` 体系为基准，保持一致；对 `windowNumber == nil` 的窗口接受“弱稳定性”并保证不崩溃。
- **风险:** 自动刷新在编辑别名时触发列表重绘，可能打断输入焦点。
- **缓解:** 编辑状态下减少/暂停列表刷新（仅更新 activeWindow/权限），或在 UI 层显式管理编辑焦点。

