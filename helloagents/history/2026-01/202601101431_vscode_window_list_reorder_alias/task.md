# 任务清单: 窗口列表交互增强（拖拽排序 / 点击激活 / 别名 / 新窗口追加）

目录: `helloagents/history/2026-01/202601101431_vscode_window_list_reorder_alias/`

---

## 0. 待确认（影响交互与实现细节）
- [√] 0.1 列表展示范围：显示**全部窗口（推荐）**，还是仅显示前 10 个？（若显示全部：热键标签仍只标注前 10 项，避免误解）
- [√] 0.2 别名编辑入口：右键菜单（推荐，最少冲突）还是行内“编辑”按钮/输入框（更显式但会破坏“整行可点”的纯语义）？

## 1. 顺序与“新窗口追加”
- [√] 1.1 在 `VSCode-Switcher/VSCode_SwitcherApp.swift` 调整 `VSCodeWindowSwitcher.listOrderedVSCodeWindows()`：当顺序为空时初始化并持久化；发现新窗口 id 时追加到末尾并写回（对应 why.md「需求: 新窗口默认追加到底部」）。
- [?] 1.2 手工验证：已存在自定义顺序时，新窗口追加到最底部且不打乱前 10 项热键映射（对应 why.md「需求: 新窗口默认追加到底部」）。

## 2. 列表拖拽排序
- [√] 2.1 在 `VSCode-Switcher/ContentView.swift` 核对并完善拖拽排序：拖拽手柄仅负责拖拽；排序后调用 `saveWindowOrder`（对应 why.md「需求: 列表拖拽排序」）。
- [√] 2.2 （依赖 0.1）若选择“显示全部窗口”，移除 `prefix(10)` 的展示限制；热键标签仅对前 10 项显示（对应 why.md「需求: 列表拖拽排序」与整体可用性）。
- [?] 2.3 手工验证：拖拽排序后刷新/重启应用顺序不变；热键 `⌃⌥1~0` 与列表前 10 项一致（对应 why.md「需求: 列表拖拽排序」）。

## 3. 点击激活区域（排除手柄）
- [√] 3.1 在 `VSCode-Switcher/ContentView.swift` 重构列表行：将“拖拽手柄”与“激活区域”分离；确保手柄右侧整行（含右侧空白）可点击激活（对应 why.md「需求: 点击激活区域覆盖整行（排除手柄）」）。
- [?] 3.2 手工验证：点击文本/点击右侧空白均能激活；点击/拖拽手柄不触发激活（对应 why.md 同需求）。

## 4. 窗口别名（编辑/清空/展示）
- [√] 4.1 在 `VSCode-Switcher/VSCode_SwitcherApp.swift` 增加别名持久化：新增 `UserDefaults` 键与 `windowAlias/setWindowAlias` 读写（对应 why.md「需求: 编辑窗口别名」）。
- [√] 4.2 在 `VSCode-Switcher/ContentView.swift` 增加别名 UI 入口（推荐：右键菜单 + 弹窗输入）；展示优先 alias，辅助展示原始 title（对应 why.md 同需求）。
- [?] 4.3 手工验证：设置/清空别名立即生效；别名不随 refresh 丢失；编辑别名不会误触发“激活窗口”（对应 why.md 同需求）。

## 5. 安全检查
- [√] 5.1 检查持久化内容：只保存 `id -> alias`，不引入新权限、不记录窗口内容；AX 调用失败路径保持可恢复。

## 6. 文档更新
- [√] 6.1 更新 `helloagents/wiki/data.md`：补充 `windowAliases` 数据与 UserDefaults 键（与实现一致）。
- [√] 6.2 更新 `helloagents/wiki/modules/vscode-switcher.md`：补充“拖拽排序/点击激活区域/别名/新窗口追加”的行为说明与限制。
- [√] 6.3 更新 `helloagents/CHANGELOG.md`：在 Unreleased 记录新增能力。

## 7. 验收（手工）
- [?] 7.1 打开 3+ 个 VSCode 窗口：右侧空白可点；点击行可激活目标；active 高亮逻辑仍正确。
- [?] 7.2 拖拽调整顺序：松手后顺序立即稳定；关闭/重开本应用后顺序保持。
- [?] 7.3 新开一个 VSCode 窗口：在不改变已有项顺序的前提下追加到列表底部；热键前 10 项不漂移。
- [?] 7.4 为任意窗口设置别名并刷新：别名仍存在；清空别名后回退显示 title。

---

## 任务状态符号
- `[ ]` 待执行
- `[√]` 已完成
- `[X]` 执行失败
- `[-]` 已跳过
- `[?]` 待确认
